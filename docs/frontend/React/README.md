# React

[React æ–‡æ¡£å­¦ä¹ ç¬”è®°](https://juejin.im/post/5d372c53e51d4555fc1acd68)

[React æŠ€æœ¯æ­ç§˜](https://react.iamkasong.com/) ğŸŒŸ


## æœ€æ–°çš„ç”Ÿå‘½å‘¨æœŸ

[æŸ¥çœ‹ React ç”Ÿå‘½å‘¨æœŸå›¾](http://projects.wojtekmaj.pl/react-lifecycle-methods-diagram/) React 16 ä¹‹åæœ‰ä¸‰ä¸ªç”Ÿå‘½å‘¨æœŸå°†è¢«åºŸå¼ƒï¼ˆä½†å¹¶æœªåˆ é™¤ï¼‰

- componentWillMount
- componentWillReceiveProps
- componentWillUpdate

> å®˜æ–¹è®¡åˆ’åœ¨ 17 ç‰ˆæœ¬å®Œå…¨åˆ é™¤è¿™ä¸‰ä¸ªå‡½æ•°ï¼Œåªä¿ç•™ UNSAVE_å‰ç¼€çš„ä¸‰ä¸ªå‡½æ•°ï¼Œç›®çš„æ˜¯ä¸ºäº†å‘ä¸‹å…¼å®¹ï¼Œä½†æ˜¯å¯¹äºå¼€å‘è€…è€Œè¨€åº”è¯¥å°½é‡é¿å…ä½¿ç”¨å®ƒä»¬ï¼Œè€Œæ˜¯ä½¿ç”¨æ–°å¢çš„ç”Ÿå‘½å‘¨æœŸå‡½æ•°æ›¿ä»£å®ƒä»¬ã€‚

![React ç”Ÿå‘½å‘¨æœŸ](../Images/react/lifecycles.png)

ç›®å‰ React 16.8 +çš„ç”Ÿå‘½å‘¨æœŸåˆ†ä¸ºä¸‰ä¸ªé˜¶æ®µï¼Œåˆ†åˆ«æ˜¯æŒ‚è½½é˜¶æ®µã€æ›´æ–°é˜¶æ®µã€å¸è½½é˜¶æ®µ

**æŒ‚è½½é˜¶æ®µï¼š**

- `constructor` æ„é€ å‡½æ•°ï¼Œæœ€å…ˆè¢«æ‰§è¡Œï¼Œæˆ‘ä»¬é€šå¸¸åœ¨æ„é€ å‡½æ•°é‡Œåˆå§‹åŒ– state å¯¹è±¡æˆ–è€…ç»™è‡ªå®šä¹‰æ–¹æ³•ç»‘å®š thisã€‚
- `getDerivedStateFromProps` å½“æˆ‘ä»¬æ¥æ”¶åˆ°æ–°çš„å±æ€§ï¼Œæƒ³å»ä¿®æ”¹æˆ‘ä»¬ state æ—¶ï¼Œå¯ä»¥ä½¿ç”¨è¿™ä¸ªé™æ€æ–¹æ³• static getDerivedStateFromProps(nextProps, prevState)ã€‚
- `render` render å‡½æ•°æ˜¯çº¯å‡½æ•°ï¼Œåªè¿”å›éœ€è¦æ¸²æŸ“çš„ä¸œè¥¿ï¼Œä¸åº”è¯¥åŒ…å«å…¶å®ƒçš„ä¸šåŠ¡é€»è¾‘ã€‚å¯ä»¥è¿”å›åŸç”Ÿçš„ DOMã€React ç»„ä»¶ã€Fragmentã€Portalsã€å­—ç¬¦ä¸²å’Œæ•°å­—ã€Boolean å’Œ null ç­‰å†…å®¹ã€‚
- `componentDidMount` ç»„ä»¶è£…è½½ä¹‹åè°ƒç”¨ï¼Œæ­¤æ—¶æˆ‘ä»¬å¯ä»¥è·å–åˆ° DOM èŠ‚ç‚¹å¹¶æ“ä½œï¼Œæ¯”å¦‚å¯¹ canvasï¼Œsvg çš„æ“ä½œï¼ŒæœåŠ¡å™¨è¯·æ±‚ï¼Œè®¢é˜…éƒ½å¯ä»¥å†™åœ¨è¿™ä¸ªé‡Œé¢ï¼Œä½†æ˜¯è®°å¾—è¦åœ¨ componentWillUnmount ä¸­å–æ¶ˆè®¢é˜…ã€‚

**æ›´æ–°é˜¶æ®µï¼š**

- getDerivedStateFromProps: æ­¤æ–¹æ³•åœ¨æ›´æ–°è·ŸæŒ‚è½½é˜¶æ®µéƒ½å¯èƒ½ä¼šè°ƒç”¨ã€‚

- `shouldComponentUpdate`  è¿™ä¸ªæ–¹æ³•æœ‰ä¸¤ä¸ªå‚æ•°(nextProps, nextState)ï¼Œè¡¨ç¤ºæ–°çš„å±æ€§å’Œå˜åŒ–ä¹‹åçš„ stateï¼Œè¿”å›ä¸€ä¸ªå¸ƒå°”å€¼ï¼Œé»˜è®¤è¿”å› true è¡¨ç¤ºä¼šè§¦å‘é‡æ–°æ¸²æŸ“ï¼Œfalse åˆ™ä¸ä¼šè§¦å‘ã€‚

  > **æˆ‘ä»¬é€šå¸¸åˆ©ç”¨æ­¤ç”Ÿå‘½å‘¨æœŸæ¥ä¼˜åŒ– React ç¨‹åºæ€§èƒ½**ã€‚å› ä¸ºè¿™ä¸ªæ–¹æ³•å…è®¸æˆ‘ä»¬æ‰‹åŠ¨åœ°åˆ¤æ–­æ˜¯å¦è¦è¿›è¡Œç»„ä»¶æ›´æ–°ï¼Œæ ¹æ®ç»„ä»¶çš„åº”ç”¨åœºæ™¯è®¾ç½®å‡½æ•°çš„åˆç†è¿”å›å€¼èƒ½å¤Ÿå¸®æˆ‘ä»¬é¿å…ä¸å¿…è¦çš„æ›´æ–°å’Œæ¸²æŸ“ã€‚

- render: æ›´æ–°é˜¶æ®µä¹Ÿä¼šè§¦å‘æ­¤ç”Ÿå‘½å‘¨æœŸã€‚

- `getSnapshotBeforeUpdate` è¿™ä¸ªæ–¹æ³•åœ¨ render ä¹‹åï¼ŒcomponentDidUpdate ä¹‹å‰è°ƒç”¨ã€‚ä¹Ÿæœ‰ä¸¤ä¸ªå‚æ•°(prevProps, prevState)ï¼Œè¡¨ç¤ºä¹‹å‰çš„å±æ€§å’Œä¹‹å‰çš„ stateï¼Œè¿™ä¸ªå‡½æ•°æœ‰ä¸€ä¸ªè¿”å›å€¼ï¼Œä¼šä½œä¸ºç¬¬ä¸‰ä¸ªå‚æ•°ä¼ ç»™ componentDidUpdateï¼Œå¦‚æœä½ ä¸æƒ³è¦è¿”å›å€¼ï¼Œå¯ä»¥è¿”å› nullï¼Œæ­¤ç”Ÿå‘½å‘¨æœŸå¿…é¡»ä¸ componentDidUpdate æ­é…ä½¿ç”¨ã€‚

- `componentDidUpdate` è¯¥æ–¹æ³•åœ¨ getSnapshotBeforeUpdate æ–¹æ³•ä¹‹åè¢«è°ƒç”¨ï¼Œæœ‰ä¸‰ä¸ªå‚æ•°(prevProps, prevState, snapshot)ï¼Œåˆ†åˆ«è¡¨ç¤ºä¹‹å‰çš„ propsï¼Œä¹‹å‰çš„ stateï¼Œå’Œ snapshotã€‚ç¬¬ä¸‰ä¸ªå‚æ•°æ˜¯ getSnapshotBeforeUpdate è¿”å›çš„ï¼Œå¦‚æœè§¦å‘æŸäº›å›è°ƒå‡½æ•°æ—¶éœ€è¦ç”¨åˆ° DOM å…ƒç´ çš„çŠ¶æ€ï¼Œåˆ™å°†å¯¹æ¯”æˆ–è®¡ç®—çš„è¿‡ç¨‹è¿ç§»è‡³ getSnapshotBeforeUpdateï¼Œç„¶ååœ¨ componentDidUpdate ä¸­ç»Ÿä¸€è§¦å‘å›è°ƒæˆ–æ›´æ–°çŠ¶æ€ã€‚

**å¸è½½é˜¶æ®µï¼š**

- `componentWillUnmount` å½“ç»„ä»¶è¢«å¸è½½æˆ–è€…é”€æ¯æ—¶å°±ä¼šè°ƒç”¨ï¼Œå¯ä»¥åœ¨è¿™ä¸ªå‡½æ•°é‡Œå»åšæ¸…é™¤å®šæ—¶å™¨ï¼Œå–æ¶ˆç½‘ç»œè¯·æ±‚ï¼Œæ¸…ç†æ— æ•ˆçš„ DOM å…ƒç´ ç­‰åƒåœ¾æ¸…ç†å·¥ä½œã€‚

## å¦‚ä½•ç†è§£ Fiber åŠ Time Slice çš„ï¼Ÿ

**React Fiber æ˜¯ä¸€ç§åŸºäºæµè§ˆå™¨çš„å•çº¿ç¨‹è°ƒåº¦ç®—æ³•ï¼š**

React 16 ä¹‹å‰ ï¼Œ`reconcilation` ç®—æ³•å®é™…ä¸Šæ˜¯é€’å½’ï¼Œæƒ³è¦ä¸­æ–­é€’å½’æ˜¯å¾ˆå›°éš¾çš„ã€‚å¦‚æœä½ æ‹¥æœ‰ä¸€ä¸ªå¾ˆå¤æ‚çš„å¤åˆç»„ä»¶ï¼Œç„¶åæ”¹åŠ¨äº†æœ€ä¸Šå±‚ç»„ä»¶çš„ `state`ï¼Œé‚£ä¹ˆè°ƒç”¨æ ˆå¯èƒ½ä¼šå¾ˆé•¿ã€‚è°ƒç”¨æ ˆè¿‡é•¿ï¼Œå†åŠ ä¸Šä¸­é—´è¿›è¡Œäº†å¤æ‚çš„æ“ä½œï¼Œå°±å¯èƒ½å¯¼è‡´é•¿æ—¶é—´é˜»å¡ä¸»çº¿ç¨‹ï¼Œå¸¦æ¥ä¸å¥½çš„ç”¨æˆ·ä½“éªŒã€‚

åœ¨ React V16 ç‰ˆæœ¬ä¸­å¼•å…¥äº† Fiber æœºåˆ¶ä½¿ç”¨å¾ªç¯æ¥ä»£æ›¿ä¹‹å‰çš„é€’å½’ç®—æ³•æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚è¿™ä¸ªæœºåˆ¶åœ¨ä¸€å®šç¨‹åº¦ä¸Šçš„å½±å“äº†éƒ¨åˆ†ç”Ÿå‘½å‘¨æœŸçš„è°ƒç”¨ï¼Œå¹¶ä¸”ä¹Ÿå¼•å…¥äº†æ–°çš„ 2 ä¸ª API æ¥è§£å†³é—®é¢˜ã€‚

**`Fiber`ï¼šä¸€ç§å°† `recocilation` ï¼ˆé€’å½’ diffï¼‰ï¼Œæ‹†åˆ†æˆæ— æ•°ä¸ªå°ä»»åŠ¡çš„ç®—æ³•ï¼›å®ƒéšæ—¶èƒ½å¤Ÿåœæ­¢ï¼Œæ¢å¤ã€‚åœæ­¢æ¢å¤çš„æ—¶æœºå–å†³äºå½“å‰çš„ä¸€å¸§ï¼ˆ16msï¼‰å†…ï¼Œè¿˜æœ‰æ²¡æœ‰è¶³å¤Ÿçš„æ—¶é—´å…è®¸è®¡ç®—ã€‚**

**Time Slice æ—¶é—´åˆ†ç‰‡ï¼š** 

![Fiber åˆ†æ®µç¤ºæ„å›¾](../Images/react/fiber.png)

Fiber æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªè™šæ‹Ÿçš„å †æ ˆå¸§ï¼Œæ–°çš„è°ƒåº¦å™¨ä¼šæŒ‰ç…§ä¼˜å…ˆçº§è‡ªç”±è°ƒåº¦è¿™äº›å¸§ï¼Œä»è€Œå°†ä¹‹å‰çš„åŒæ­¥æ¸²æŸ“æ”¹æˆäº†å¼‚æ­¥æ¸²æŸ“ï¼Œåœ¨ä¸å½±å“ä½“éªŒçš„æƒ…å†µä¸‹å»åˆ†æ®µè®¡ç®—æ›´æ–°ã€‚æ—¶é—´åˆ†ç‰‡æ­£æ˜¯åŸºäºå¯éšæ—¶æ‰“æ–­ã€é‡å¯çš„ Fiber æ¶æ„ï¼Œå¯æ‰“æ–­å½“å‰ä»»åŠ¡ï¼Œä¼˜å…ˆå¤„ç†ç´§æ€¥ä¸”é‡è¦çš„ä»»åŠ¡ï¼Œä¿è¯é¡µé¢çš„æµç•…è¿è¡Œã€‚

> å¯¹äºå¦‚ä½•åŒºåˆ«ä¼˜å…ˆçº§ï¼ŒReact æœ‰è‡ªå·±çš„ä¸€å¥—é€»è¾‘ã€‚
>
> 1. å¯¹äºåŠ¨ç”»è¿™ç§å®æ—¶æ€§å¾ˆé«˜çš„ä¸œè¥¿ï¼Œä¹Ÿå°±æ˜¯ 16 ms å¿…é¡»æ¸²æŸ“ä¸€æ¬¡ä¿è¯ä¸å¡é¡¿çš„æƒ…å†µä¸‹ï¼ŒReact ä¼šæ¯ 16 msï¼ˆä»¥å†…ï¼‰ æš‚åœä¸€ä¸‹æ›´æ–°ï¼Œè¿”å›æ¥ç»§ç»­æ¸²æŸ“åŠ¨ç”»
> 2. æ ¹æ®äº‹ä»¶ç±»å‹æ¥ã€‚æ‰“ä¸ªæ¯”æ–¹ï¼Œç‚¹å‡»äº‹ä»¶ã€ç”¨æˆ·è¾“å…¥äº‹ä»¶ï¼Œç›¸æ¯”æ»šåŠ¨äº‹ä»¶çš„ä¼˜å…ˆçº§è¦é«˜ ã€‚ç›®å‰ React å†…éƒ¨äº‹ä»¶æœºåˆ¶æœ‰ç®€å•åŒºåˆ†ä¼˜å…ˆçº§
> 3. äººå·¥æç¤º Reactã€‚å‚è€ƒå®éªŒç‰ˆæœ¬é‡Œé¢çš„ useTransitionï¼ŒuseDeferredValue  
> 4. éšè—å†…å®¹çš„æ›´æ–°ä¼˜å…ˆçº§æœ€ä½ã€‚è¿™é€šå¸¸ä¹Ÿéœ€è¦æç¤º React æŒ‡å®šç»„ä»¶æ˜¯éšè—çš„ï¼Œç›®å‰æ²¡æœ‰å…¬å¼€ API

> æ¨èé˜…è¯»ï¼š[è¿™å¯èƒ½æ˜¯æœ€é€šä¿—çš„ React Fiberï¼ˆæ—¶é—´åˆ†ç‰‡ï¼‰ æ‰“å¼€æ–¹å¼](https://juejin.im/post/5dadc6045188255a270a0f85) 

## Ajax è¯·æ±‚åº”è¯¥æ”¾åœ¨å“ªä¸ªç”Ÿå‘½å‘¨æœŸä¸­ï¼Ÿ

::: tip

æ¨èå°†å¼‚æ­¥è¯·æ±‚æ”¾åœ¨ componentDidmount å‡½æ•°ä¸­è¿›è¡Œã€‚

:::

å¦‚æœæœ‰ç‰¹æ®Šéœ€æ±‚éœ€è¦æå‰è¯·æ±‚ï¼Œä¹Ÿå¯ä»¥åœ¨ constructor ä¸­è¿›è¡Œã€‚

æœ‰äººè®¤ä¸ºåœ¨ componentWillMount ä¸­å‘èµ· Ajax è¯·æ±‚å¯ä»¥æå‰å¼‚æ­¥è·å–æ•°æ®ï¼Œè¾¾åˆ°é¿å…é¡µé¢ç™½å±çš„æ•ˆæœã€‚ä½†å…¶å®è¿™ä¸ªè§‚ç‚¹æ˜¯æœ‰é—®é¢˜çš„ã€‚

é¦–å…ˆï¼šå› ä¸º JavaScript ä¸­å¼‚æ­¥äº‹ä»¶çš„æ€§è´¨ï¼Œå½“è¿›è¡Œ API è°ƒç”¨æ—¶ï¼Œæµè§ˆå™¨ä¼šåœ¨æ­¤æœŸé—´è¿”å›å»æ‰§è¡Œå…¶ä»–å·¥ä½œã€‚æ‰€ä»¥å½“ React æ¸²æŸ“ä¸€ä¸ªç»„ä»¶æ—¶ï¼Œå®ƒä¸ä¼šç­‰å¾… componentWillMount ä¸­çš„ä»»ä½•ä¸œè¥¿ï¼Œè€Œæ˜¯ç»§ç»­è¿›è¡Œ renderã€‚å³ï¼šä¸ä¼šâ€œæš‚åœâ€æ¸²æŸ“ä»¥ç­‰å¾…æ•°æ®åˆ°è¾¾ã€‚

å…¶æ¬¡ï¼š**åœ¨ componentWillMount ä¸­å‘èµ·è¯·æ±‚ä¼šæœ‰ä¸€ç³»åˆ—æ½œåœ¨çš„é—®é¢˜ï¼š**

1. åœ¨ SSR æœåŠ¡å™¨æ¸²æŸ“æ—¶ï¼Œå¦‚æœåœ¨ componentWillMount é‡Œè·å–æ•°æ®ï¼Œfetch data ä¼šæ‰§è¡Œä¸¤æ¬¡ï¼Œä¸€æ¬¡åœ¨æœåŠ¡ç«¯ä¸€æ¬¡åœ¨å®¢æˆ·ç«¯ï¼Œè¿™é€ æˆäº†å¤šä½™çš„è¯·æ±‚ã€‚
2. åœ¨ React 16 è¿›è¡Œ React Fiber é‡å†™åï¼Œä¼šé€šè¿‡å¼€å§‹æˆ–åœæ­¢æ¸²æŸ“çš„æ–¹å¼ä¼˜åŒ–åº”ç”¨æ€§èƒ½ã€‚componentWillMount è¿™ä¸ªç”Ÿå‘½å‘¨æœŸå‡½æ•°çš„è°ƒç”¨æ¬¡æ•°ä¼šå˜å¾—ä¸ç¡®å®šã€‚é‚£ä¹ˆå°† Ajax è¯·æ±‚æ”¾åœ¨è¿™é‡Œè‡ªç„¶ä¹Ÿå°±ä¸æ˜¯å¥½çš„é€‰æ‹©ã€‚

## setState åˆ°åº•æ˜¯å¼‚æ­¥è¿˜æ˜¯åŒæ­¥ï¼Ÿ

`setState` åœ¨ React ä¸­æ˜¯ç»å¸¸ä½¿ç”¨çš„ä¸€ä¸ª APIï¼Œä½†æ˜¯å®ƒå­˜åœ¨ä¸€äº›é—®é¢˜ï¼Œå¯èƒ½ä¼šå¯¼è‡´çŠ¯é”™ï¼Œæ ¸å¿ƒåŸå› å°±æ˜¯å› ä¸ºè¿™ä¸ª API **æœ‰æ—¶è¡¨ç°å‡ºå¼‚æ­¥ï¼Œæœ‰æ—¶è¡¨ç°å‡ºåŒæ­¥**ã€‚

1. setState åªåœ¨åˆæˆäº‹ä»¶å’Œé’©å­å‡½æ•°ä¸­æ˜¯â€œå¼‚æ­¥â€çš„ï¼Œåœ¨åŸç”Ÿäº‹ä»¶å’Œ setTimeout ä¸­éƒ½æ˜¯åŒæ­¥çš„ã€‚
2. setState çš„â€œå¼‚æ­¥â€å¹¶ä¸æ˜¯è¯´å†…éƒ¨ç”±å¼‚æ­¥ä»£ç å®ç°ï¼Œå…¶å®æœ¬èº«æ‰§è¡Œçš„è¿‡ç¨‹å’Œä»£ç éƒ½æ˜¯åŒæ­¥çš„ï¼Œåªæ˜¯åˆæˆäº‹ä»¶å’Œé’©å­å‡½æ•°çš„è°ƒç”¨é¡ºåºåœ¨æ›´æ–°ä¹‹å‰ï¼Œå¯¼è‡´åœ¨åˆæˆäº‹ä»¶å’Œé’©å­å‡½æ•°ä¸­æ²¡æ³•ç«‹é©¬æ‹¿åˆ°æ›´æ–°åçš„å€¼ï¼Œå½¢æˆäº†æ‰€è°“çš„â€œå¼‚æ­¥â€ï¼Œå½“ç„¶å¯ä»¥é€šè¿‡ç¬¬äºŒä¸ªå‚æ•° setState(partialState, callback) ä¸­çš„ callback æ‹¿åˆ°æ›´æ–°åçš„ç»“æœã€‚
  ```js
    handle() {
      this.setState((prevState) => ({ count: prevState.count + 1 }), () => {
          console.log(this.state)
      })
    }
  ```
3. setState çš„æ‰¹é‡æ›´æ–°ä¼˜åŒ–ä¹Ÿæ˜¯å»ºç«‹åœ¨â€œå¼‚æ­¥â€ï¼ˆåˆæˆäº‹ä»¶ã€é’©å­å‡½æ•°ï¼‰ä¹‹ä¸Šçš„ï¼Œåœ¨åŸç”Ÿäº‹ä»¶å’Œ setTimeout ä¸­ä¸ä¼šæ‰¹é‡æ›´æ–°ï¼Œåœ¨â€œå¼‚æ­¥â€ä¸­å¦‚æœå¯¹åŒä¸€ä¸ªå€¼è¿›è¡Œå¤šæ¬¡ setStateï¼ŒsetState çš„æ‰¹é‡æ›´æ–°ç­–ç•¥ä¼šå¯¹å…¶è¿›è¡Œè¦†ç›–ï¼Œå–æœ€åä¸€æ¬¡çš„æ‰§è¡Œï¼Œå¦‚æœæ˜¯åŒæ—¶ setState å¤šä¸ªä¸åŒçš„å€¼ï¼Œåœ¨æ›´æ–°æ—¶ä¼šå¯¹å…¶è¿›è¡Œåˆå¹¶æ‰¹é‡æ›´æ–°ã€‚

```js
handle() {
  // åˆå§‹åŒ– `count` ä¸º 0
  console.log(this.state.count) // -> 0
  this.setState({ count: this.state.count + 1 })
  console.log(this.state.count) // -> 0
}
```
> - ä¸¤æ¬¡çš„æ‰“å°éƒ½ä¸º 0ï¼Œå› ä¸º `setState` æ˜¯ä¸ª "å¼‚æ­¥ API"ï¼Œåªæœ‰åŒæ­¥ä»£ç è¿è¡Œå®Œæ¯•æ‰ä¼šæ‰§è¡Œã€‚`setState` å¼‚æ­¥çš„åŸå› æˆ‘è®¤ä¸ºåœ¨äºï¼Œ`setState` å¯èƒ½ä¼šå¯¼è‡´ DOM çš„é‡ç»˜ï¼Œå¦‚æœè°ƒç”¨ä¸€æ¬¡å°±é©¬ä¸Šå»è¿›è¡Œé‡ç»˜ï¼Œé‚£ä¹ˆè°ƒç”¨å¤šæ¬¡å°±ä¼šé€ æˆä¸å¿…è¦çš„æ€§èƒ½æŸå¤±ã€‚è®¾è®¡æˆå¼‚æ­¥çš„è¯ï¼Œå°±å¯ä»¥å°†å¤šæ¬¡è°ƒç”¨æ”¾å…¥ä¸€ä¸ªé˜Ÿåˆ—ä¸­ï¼Œåœ¨æ°å½“çš„æ—¶å€™ç»Ÿä¸€è¿›è¡Œæ›´æ–°è¿‡ç¨‹ã€‚
> - è™½ç„¶è°ƒç”¨äº†ä¸‰æ¬¡ `setState` ï¼Œä½†æ˜¯æœ€ç»ˆ `count` çš„å€¼è¿˜æ˜¯ä¸º 1ã€‚å› ä¸ºå¤šæ¬¡è°ƒç”¨ä¼šåˆå¹¶ä¸ºä¸€æ¬¡ï¼Œåªæœ‰å½“æ›´æ–°ç»“æŸå `state` æ‰ä¼šæ”¹å˜ï¼Œä¸‰æ¬¡è°ƒç”¨ç­‰åŒäºå¦‚ä¸‹ä»£ç 
> ```js
>     Object.assign(
>       {},
>       { count: this.state.count + 1 },
>       { count: this.state.count + 1 }
>     )
> ```

## React ä¸­ keys çš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ

::: tip

Keys æ˜¯ React ç”¨äºè¿½è¸ªåˆ—è¡¨ä¸­å“ªäº›å…ƒç´ è¢«ä¿®æ”¹ã€è¢«æ·»åŠ æˆ–è€…è¢«ç§»é™¤çš„è¾…åŠ©æ ‡è¯†ã€‚

:::

> é€šå¸¸æˆ‘ä»¬è¾“å‡ºèŠ‚ç‚¹çš„æ—¶å€™éƒ½æ˜¯ map ä¸€ä¸ªæ•°ç»„ç„¶åè¿”å›ä¸€ä¸ª`ReactNode`ï¼Œä¸ºäº†æ–¹ä¾¿Reactå†…éƒ¨è¿›è¡Œä¼˜åŒ–ï¼Œæˆ‘ä»¬å¿…é¡»ç»™æ¯ä¸€ä¸ª`reactNode`æ·»åŠ `key`ï¼Œè¿™ä¸ª`key prop`åœ¨è®¾è®¡ä¹‹åˆä¸æ˜¯ç»™å¼€å‘è€…ç”¨çš„ï¼Œè€Œæ˜¯ç»™reactç”¨çš„ã€‚
>
> å¤§æ¦‚çš„ä½œç”¨å°±æ˜¯ç»™æ¯ä¸€ä¸ª`reactNode`æ·»åŠ ä¸€ä¸ªèº«ä»½æ ‡è¯†ï¼Œæ–¹ä¾¿Reactè¿›è¡Œè¯†åˆ«ï¼Œåœ¨é‡æ¸²æŸ“è¿‡ç¨‹ä¸­ï¼Œå¦‚æœ`key`ä¸€æ ·ï¼Œè‹¥ç»„ä»¶å±æ€§æœ‰æ‰€å˜åŒ–ï¼Œåˆ™ Reactåªæ›´æ–°ç»„ä»¶å¯¹åº”çš„å±æ€§ï¼Œæ²¡æœ‰å˜åŒ–åˆ™ä¸æ›´æ–°ã€‚
>
> è€Œåœ¨react çš„æ¸²æŸ“è¿‡ç¨‹ä¸­ï¼Œå…„å¼ŸèŠ‚ç‚¹ä¹‹é—´ï¼Œä¹Ÿå°±æ˜¯`key`å€¼ä¸ä¸€æ ·çš„æ—¶å€™ï¼Œåˆ™reactä¼šå…ˆé”€æ¯è¯¥ç»„ä»¶ï¼Œç„¶åé‡æ–°åˆ›å»ºè¯¥ç»„ä»¶ã€‚

åœ¨ `React Diff` ç®—æ³•ä¸­ä¼šå€ŸåŠ©å…ƒç´ çš„ `Key` å€¼æ¥åˆ¤æ–­è¯¥å…ƒç´ æ˜¯æ–°è¿‘åˆ›å»ºçš„è¿˜æ˜¯è¢«ç§»åŠ¨è€Œæ¥çš„å…ƒç´ ï¼Œä»è€Œå‡å°‘ä¸å¿…è¦çš„æ¸²æŸ“ï¼Œæå‡æ€§èƒ½ã€‚æ‰€ä»¥åœ¨å¼€å‘è¿‡ç¨‹ä¸­ï¼Œ**æˆ‘ä»¬éœ€è¦ä¿è¯æŸä¸ªå…ƒç´ çš„ `key` åœ¨å…¶åŒçº§å…ƒç´ ä¸­å…·æœ‰å”¯ä¸€æ€§**ã€‚

> key è¦ç”¨å”¯ä¸€å€¼ï¼Œæ‰€ä»¥ä¸èƒ½åœ¨æ•°ç»„mapçš„æ—¶å€™ç”¨ indexï¼Œå¦‚æœåœ¨æœ€å‰é¢å¢åŠ ä¸€é¡¹ï¼Œä¹‹å‰æ¸²æŸ“çš„é¡¹å¯¹åº”çš„ index éƒ½å˜äº†ï¼Œè¿™æ ·å…¶å®å°±è·Ÿæ²¡è®¾ç½®keyä¸€æ ·äº†ã€‚

æ­¤å¤–ï¼ŒReact è¿˜éœ€è¦å€ŸåŠ© `Key` å€¼æ¥åˆ¤æ–­å…ƒç´ ä¸æœ¬åœ°çŠ¶æ€çš„å…³è”å…³ç³»ï¼Œå› æ­¤æˆ‘ä»¬ç»ä¸å¯å¿½è§†è½¬æ¢å‡½æ•°ä¸­ `Key` çš„é‡è¦æ€§ã€‚

## React ä¸­çš„äº‹ä»¶å¤„ç†æœºåˆ¶ï¼Ÿ

::: tip

React è‡ªå·±å®ç°äº†ä¸€å¥—åˆæˆäº‹ä»¶æœºåˆ¶ï¼Œå¸¦æ¥äº†è·¨æµè§ˆå™¨å¼€å‘ä¸æ€§èƒ½ä¼˜åŒ–çš„å¥½å¤„ã€‚

:::

é¦–å…ˆæˆ‘ä»¬æ€è€ƒä¸€ä¸‹ä»¥ä¸‹ä»£ç ï¼š

```js
const Test = ({ list, handleClick }) => ({
    list.map((item, index) => (
        <span onClick={handleClick} key={index}>{index}</span>
    ))
})
```

ä»¥ä¸Šç±»ä¼¼çš„ä»£ç æƒ³å¿…å¤§å®¶ç»å¸¸ä¼šå†™ï¼Œä½†æ˜¯ä½ æ˜¯å¦è€ƒè™‘è¿‡ç‚¹å‡»äº‹ä»¶æ˜¯ç»‘å®šåœ¨äº†æ¯ä¸€ä¸ªæ ‡ç­¾ä¸Šçš„å—ï¼Ÿ

äº‹å®å½“ç„¶ä¸æ˜¯ï¼ŒJSX ä¸Šå†™çš„äº‹ä»¶å¹¶æ²¡æœ‰ç»‘å®šåœ¨å¯¹åº”çš„çœŸå® DOM ä¸Šï¼Œè€Œæ˜¯é€šè¿‡äº‹ä»¶ä»£ç†çš„æ–¹å¼ï¼Œå°†æ‰€æœ‰çš„äº‹ä»¶éƒ½ç»Ÿä¸€ç»‘å®šåœ¨äº† `document` ä¸Šã€‚è¿™æ ·çš„æ–¹å¼ä¸ä»…å‡å°‘äº†å†…å­˜æ¶ˆè€—ï¼Œè¿˜èƒ½åœ¨ç»„ä»¶æŒ‚è½½é”€æ¯æ—¶ç»Ÿä¸€è®¢é˜…å’Œç§»é™¤äº‹ä»¶ã€‚

> å¯¹äºåŸç”Ÿæµè§ˆå™¨äº‹ä»¶æ¥è¯´ï¼Œæµè§ˆå™¨ä¼šç»™ç›‘å¬å™¨åˆ›å»ºä¸€ä¸ªäº‹ä»¶å¯¹è±¡ã€‚å¦‚æœä½ æœ‰å¾ˆå¤šçš„äº‹ä»¶ç›‘å¬ï¼Œé‚£ä¹ˆå°±éœ€è¦åˆ†é…å¾ˆå¤šçš„äº‹ä»¶å¯¹è±¡ï¼Œé€ æˆé«˜é¢çš„å†…å­˜åˆ†é…é—®é¢˜ã€‚ä½†æ˜¯å¯¹äºåˆæˆäº‹ä»¶æ¥è¯´ï¼Œæœ‰ä¸€ä¸ªäº‹ä»¶æ± ä¸“é—¨æ¥ç®¡ç†å®ƒä»¬çš„åˆ›å»ºå’Œé”€æ¯ï¼Œå½“äº‹ä»¶éœ€è¦è¢«ä½¿ç”¨æ—¶ï¼Œå°±ä¼šä»æ± å­ä¸­å¤ç”¨å¯¹è±¡ï¼Œäº‹ä»¶å›è°ƒç»“æŸåï¼Œå°±ä¼šé”€æ¯äº‹ä»¶å¯¹è±¡ä¸Šçš„å±æ€§ï¼Œä»è€Œä¾¿äºä¸‹æ¬¡å¤ç”¨äº‹ä»¶å¯¹è±¡ã€‚

å¦å¤–ï¼Œå†’æ³¡åˆ° `document` ä¸Šçš„äº‹ä»¶ä¹Ÿä¸æ˜¯åŸç”Ÿæµè§ˆå™¨äº‹ä»¶ï¼ˆBrowser Native Eventï¼‰ï¼Œè€Œæ˜¯Reactè‡ªå·±å®ç°çš„åˆæˆäº‹ä»¶ï¼ˆSyntheticEventï¼‰ã€‚å› æ­¤æˆ‘ä»¬å¦‚æœä¸æƒ³è¦äº‹ä»¶å†’æ³¡çš„è¯ï¼Œè°ƒç”¨ `event.stopPropagation` æ˜¯æ— æ•ˆçš„ï¼Œè€Œåº”è¯¥è°ƒç”¨ `event.preventDefault`

**é‚£ä¹ˆå®ç°åˆæˆäº‹ä»¶çš„ç›®çš„æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿæ€»çš„æ¥è¯´å¥½å¤„æœ‰ä¸¤ç‚¹ï¼Œåˆ†åˆ«æ˜¯ï¼š**

1. åˆæˆäº‹ä»¶æä¾›äº†ä¸åŸç”Ÿäº‹ä»¶ç›¸åŒçš„æ¥å£ï¼Œä¿è¯äº†è¡Œä¸ºçš„ä¸€è‡´æ€§ã€‚åŒæ—¶å®ƒæŠ¹å¹³äº†åº•å±‚æµè§ˆå™¨çš„ç»†èŠ‚å·®å¼‚ï¼Œè§£å†³äº†è·¨æµè§ˆå™¨çš„å…¼å®¹æ€§é—®é¢˜ã€‚å¦å¤–ï¼Œè¿™æ˜¯ä¸€ä¸ªè·¨æµè§ˆå™¨çš„åŸç”Ÿäº‹ä»¶åŒ…è£…å™¨ï¼Œèµ‹äºˆäº†è·¨æµè§ˆå™¨å¼€å‘çš„èƒ½åŠ›  ã€‚
2. æœ‰æ„æ€çš„æ˜¯ï¼ŒReact å¹¶æ²¡æœ‰ç›´æ¥å°†äº‹ä»¶é™„ç€åˆ°å­å…ƒç´ ä¸Šï¼Œè€Œæ˜¯ä»¥å•ä¸€äº‹ä»¶ç›‘å¬å™¨çš„æ–¹å¼å°†æ‰€æœ‰çš„äº‹ä»¶å‘é€åˆ°é¡¶å±‚è¿›è¡Œå¤„ç†ã€‚è¿™æ · React åœ¨æ›´æ–° DOM çš„æ—¶å€™å°±ä¸éœ€è¦è€ƒè™‘å¦‚ä½•å»å¤„ç†é™„ç€åœ¨ DOM ä¸Šçš„äº‹ä»¶ç›‘å¬å™¨ï¼Œæœ€ç»ˆè¾¾åˆ°ä¼˜åŒ–æ€§èƒ½çš„ç›®çš„ã€‚

## ä½¿ç”¨ React æ—¶æœ‰ä»€ä¹ˆå‘ï¼Ÿ

**1. JSXåšè¡¨è¾¾å¼åˆ¤æ–­æ—¶å€™ï¼Œéœ€è¦å¼ºè½¬ä¸ºbooleanç±»å‹ã€‚**

**2. å°½é‡ä¸è¦åœ¨ componentWillReviceProps é‡Œä½¿ç”¨ setStateï¼Œå¦‚æœä¸€å®šè¦ä½¿ç”¨ï¼Œé‚£ä¹ˆéœ€è¦åˆ¤æ–­ç»“æŸæ¡ä»¶ï¼Œä¸ç„¶ä¼šå‡ºç°æ— é™é‡æ¸²æŸ“ï¼Œå¯¼è‡´é¡µé¢å´©æºƒã€‚**

**3. ç»™ç»„ä»¶æ·»åŠ refæ—¶å€™ï¼Œå°½é‡ä¸è¦ä½¿ç”¨åŒ¿åå‡½æ•°ï¼Œå› ä¸ºå½“ç»„ä»¶æ›´æ–°çš„æ—¶å€™ï¼ŒåŒ¿åå‡½æ•°ä¼šè¢«å½“åšæ–°çš„propå¤„ç†ï¼Œè®©refå±æ€§æ¥å—åˆ°æ–°å‡½æ•°çš„æ—¶å€™ï¼Œreactå†…éƒ¨ä¼šå…ˆæ¸…ç©ºrefï¼Œä¹Ÿå°±æ˜¯ä¼šä»¥nullä¸ºå›è°ƒå‚æ•°å…ˆæ‰§è¡Œä¸€æ¬¡refè¿™ä¸ªpropsï¼Œç„¶ååœ¨ä»¥è¯¥ç»„ä»¶çš„å®ä¾‹æ‰§è¡Œä¸€æ¬¡refï¼Œæ‰€ä»¥ç”¨åŒ¿åå‡½æ•°åšrefçš„æ—¶å€™ï¼Œæœ‰çš„æ—¶å€™å»refèµ‹å€¼åçš„å±æ€§ä¼šå–åˆ°nullã€‚**

## React ç»„ä»¶é€šä¿¡å¦‚ä½•å®ç°ï¼Ÿ

- çˆ¶ç»„ä»¶å‘å­ç»„ä»¶é€šè®¯ï¼šçˆ¶ç»„ä»¶å¯ä»¥å‘é€šè¿‡ä¼ é€’ props çš„æ–¹å¼å‘å­ç»„ä»¶è¿›è¡Œé€šè®¯
- å­ç»„ä»¶å‘çˆ¶ç»„ä»¶é€šè®¯ï¼šprops+å›è°ƒçš„æ–¹å¼ï¼Œçˆ¶ç»„ä»¶å‘å­ç»„ä»¶ä¼ é€’çš„ props ä¸­æœ‰ä½œç”¨åŸŸä¸ºçˆ¶ç»„ä»¶è‡ªèº«çš„å‡½æ•°æ–¹æ³•ï¼Œç„¶åå­ç»„ä»¶è°ƒç”¨è¯¥å‡½æ•°ï¼Œå°†å­ç»„ä»¶æƒ³è¦ä¼ é€’çš„ä¿¡æ¯ï¼Œä½œä¸ºå‚æ•°ï¼Œä¼ é€’åˆ°çˆ¶ç»„ä»¶çš„ä½œç”¨åŸŸä¸­
- å…„å¼Ÿç»„ä»¶é€šä¿¡ï¼šæ‰¾åˆ°è¿™ä¸¤ä¸ªå…„å¼ŸèŠ‚ç‚¹å…±åŒçš„çˆ¶èŠ‚ç‚¹ï¼Œç»“åˆä¸Šé¢ä¸¤ç§æ–¹å¼ç”±çˆ¶èŠ‚ç‚¹è½¬å‘ä¿¡æ¯è¿›è¡Œé€šä¿¡
- è·¨å±‚çº§é€šä¿¡ï¼šContext è®¾è®¡ç›®çš„æ˜¯ä¸ºäº†å…±äº«é‚£äº›å¯¹äºä¸€ä¸ªç»„ä»¶æ ‘è€Œè¨€æ˜¯â€œå…¨å±€â€çš„æ•°æ®ï¼Œä¾‹å¦‚å½“å‰è®¤è¯çš„ç”¨æˆ·ã€ä¸»é¢˜æˆ–é¦–é€‰è¯­è¨€ï¼Œå¯¹äºè·¨è¶Šå¤šå±‚çš„å…¨å±€æ•°æ®é€šè¿‡ Context é€šä¿¡å†é€‚åˆä¸è¿‡
- å‘å¸ƒè®¢é˜…æ¨¡å¼ï¼šå‘å¸ƒè€…å‘å¸ƒäº‹ä»¶ï¼Œè®¢é˜…è€…ç›‘å¬äº‹ä»¶å¹¶åšå‡ºååº”ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å¼•å…¥ event æ¨¡å—è¿›è¡Œé€šä¿¡
- å…¨å±€çŠ¶æ€ç®¡ç†å·¥å…·ï¼šå€ŸåŠ© Redux æˆ–è€… Mobx ç­‰å…¨å±€çŠ¶æ€ç®¡ç†å·¥å…·è¿›è¡Œé€šä¿¡ï¼Œè¿™ç§å·¥å…·ä¼šç»´æŠ¤ä¸€ä¸ªå…¨å±€çŠ¶æ€ä¸­å¿ƒ Store, å¹¶æ ¹æ®ä¸åŒçš„äº‹ä»¶äº§ç”Ÿæ–°çš„çŠ¶æ€

![reduxStore](../Images/react/reduxStore.png)

## Redux çš„å·¥ä½œæµç¨‹ï¼Ÿ

**æ ¸å¿ƒæ¦‚å¿µï¼š**

- Storeï¼šä¿å­˜æ•°æ®çš„åœ°æ–¹ï¼Œä½ å¯ä»¥æŠŠå®ƒçœ‹æˆä¸€ä¸ªå®¹å™¨ï¼Œæ•´ä¸ªåº”ç”¨åªèƒ½æœ‰ä¸€ä¸ª Storeã€‚
- Stateï¼šStore å¯¹è±¡åŒ…å«æ‰€æœ‰æ•°æ®ï¼Œå¦‚æœæƒ³å¾—åˆ°æŸä¸ªæ—¶åˆ»çš„æ•°æ®ï¼Œå°±è¦å¯¹ Store ç”Ÿæˆå¿«ç…§ï¼Œè¿™ç§æŸä¸ªæ—¶åˆ»å¿«ç…§çš„æ•°æ®é›†åˆï¼Œå°±å«åš Stateã€‚
- Actionï¼šState çš„å˜åŒ–ï¼Œä¼šå¯¼è‡´ View çš„å˜åŒ–ã€‚ä½†æ˜¯ï¼Œç”¨æˆ·æ¥è§¦ä¸åˆ° Stateï¼Œåªèƒ½æ¥è§¦åˆ° Viewã€‚æ‰€ä»¥ï¼ŒState çš„å˜åŒ–å¿…é¡»æ˜¯ View å¯¼è‡´çš„ã€‚Actionï¼ˆä¸€ä¸ªç”¨æ¥æè¿°è¦å¯¹ State åšä»€ä¹ˆä¿®æ”¹çš„å¯¹è±¡ï¼‰å°±æ˜¯ View å‘å‡ºçš„é€šçŸ¥ï¼Œè¡¨ç¤º State åº”è¯¥è¦å‘ç”Ÿå˜åŒ–äº†ã€‚
- Action Creatorï¼šView è¦å‘é€å¤šå°‘ç§æ¶ˆæ¯ï¼Œå°±ä¼šæœ‰å¤šå°‘ç§ Actionã€‚å¦‚æœéƒ½æ‰‹å†™ï¼Œä¼šå¾ˆéº»çƒ¦ï¼Œæ‰€ä»¥æˆ‘ä»¬å®šä¹‰ä¸€ä¸ªå‡½æ•°æ¥ç”Ÿæˆ Actionï¼Œè¿™ä¸ªå‡½æ•°å°±å« Action Creatorã€‚
- Reducerï¼šStore æ”¶åˆ° Action ä»¥åï¼Œå¿…é¡»ç»™å‡ºä¸€ä¸ªæ–°çš„ Stateï¼Œè¿™æ · View æ‰ä¼šå‘ç”Ÿå˜åŒ–ã€‚è¿™ç§ State çš„è®¡ç®—è¿‡ç¨‹å°±å«åš Reducerã€‚Reducer æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œå®ƒæ¥å— Action å’Œå½“å‰ State ä½œä¸ºå‚æ•°ï¼Œè¿”å›ä¸€ä¸ªæ–°çš„ Stateã€‚
- dispatchï¼šæ˜¯ View å‘å‡º Action çš„å”¯ä¸€æ–¹æ³•ã€‚

> Redux åªæœ‰ä¸€ä¸ªå•ä¸€çš„ store å’Œä¸€ä¸ªæ ¹çº§çš„ reduce å‡½æ•°ï¼ˆreducerï¼‰ã€‚éšç€åº”ç”¨ä¸æ–­å˜å¤§ï¼Œä½ åº”è¯¥æŠŠæ ¹çº§çš„ reducer æ‹†æˆå¤šä¸ªå°çš„ reducersï¼Œåˆ†åˆ«ç‹¬ç«‹åœ°æ“ä½œ state æ ‘çš„ä¸åŒéƒ¨åˆ†ï¼Œè€Œä¸æ˜¯æ·»åŠ æ–°çš„ storesã€‚è¿™å°±åƒä¸€ä¸ª React åº”ç”¨åªæœ‰ä¸€ä¸ªæ ¹çº§çš„ç»„ä»¶ï¼Œè¿™ä¸ªæ ¹ç»„ä»¶åˆç”±å¾ˆå¤šå°ç»„ä»¶æ„æˆã€‚

**å®Œæ•´å·¥ä½œæµç¨‹ï¼š**

1. é¦–å…ˆï¼Œç”¨æˆ·ï¼ˆé€šè¿‡ Viewï¼‰å‘å‡º Actionï¼Œå‘å‡ºæ–¹å¼å°±ç”¨åˆ°äº† dispatch æ–¹æ³•ã€‚
2. ç„¶åï¼ŒStore è‡ªåŠ¨è°ƒç”¨ Reducerï¼Œå¹¶ä¸”ä¼ å…¥ä¸¤ä¸ªå‚æ•°ï¼šå½“å‰ State å’Œæ”¶åˆ°çš„ Actionï¼ŒReducer ä¼šè¿”å›æ–°çš„ Stateã€‚
3. State ä¸€æ—¦æœ‰å˜åŒ–ï¼ŒStore å°±ä¼šè°ƒç”¨ç›‘å¬å‡½æ•°ï¼Œæ¥æ›´æ–° Viewã€‚

åˆ°è¿™å„¿ä¸ºæ­¢ï¼Œä¸€æ¬¡ç”¨æˆ·äº¤äº’æµç¨‹ç»“æŸã€‚å¯ä»¥çœ‹åˆ°ï¼Œåœ¨æ•´ä¸ªæµç¨‹ä¸­æ•°æ®éƒ½æ˜¯å•å‘æµåŠ¨çš„ï¼Œè¿™ç§æ–¹å¼ä¿è¯äº†æµç¨‹çš„æ¸…æ™°ã€‚

![redux å·¥ä½œæµ](../Images/react/redux-life.png)

**Redux çš„ç¼ºç‚¹ï¼š**

- ä¸€ä¸ªç»„ä»¶æ‰€éœ€è¦çš„æ•°æ®ï¼Œå¿…é¡»ç”±çˆ¶ç»„ä»¶ä¼ è¿‡æ¥ï¼Œè€Œä¸èƒ½åƒ flux é‚£æ ·ç›´æ¥ä» store ä¸­å–ã€‚
- å½“ä¸€ä¸ªç»„ä»¶ç›¸å…³çš„æ•°æ®æ›´æ–°æ—¶ï¼Œå³ä½¿çˆ¶ç»„ä»¶ä¸éœ€è¦ç”¨åˆ°è¿™ä¸ªç»„ä»¶ï¼Œçˆ¶ç»„ä»¶è¿˜æ˜¯ä¼šé‡æ–° renderï¼Œå¯èƒ½ä¼šæœ‰æ•ˆç‡å½±å“ï¼Œæˆ–è€…éœ€è¦å†™å¤æ‚çš„shouldComponentUpdate è¿›è¡Œåˆ¤æ–­ã€‚

## Redux ä¸­å¦‚ä½•è¿›è¡Œå¼‚æ­¥æ“ä½œï¼Ÿ

å½“ç„¶ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨`componentDidmount`ä¸­ç›´æ¥è¿›è¡Œè¯·æ±‚æ— é¡»å€ŸåŠ© reduxã€‚

ä½†æ˜¯åœ¨ä¸€å®šè§„æ¨¡çš„é¡¹ç›®ä¸­ï¼Œä¸Šè¿°æ–¹æ³•å¾ˆéš¾è¿›è¡Œå¼‚æ­¥æµçš„ç®¡ç†ï¼Œé€šå¸¸æƒ…å†µä¸‹æˆ‘ä»¬ä¼šå€ŸåŠ© redux çš„å¼‚æ­¥ä¸­é—´ä»¶è¿›è¡Œå¼‚æ­¥å¤„ç†ã€‚

redux å¼‚æ­¥æµä¸­é—´ä»¶å…¶å®æœ‰å¾ˆå¤šï¼Œä½†æ˜¯å½“ä¸‹ä¸»æµçš„å¼‚æ­¥ä¸­é—´ä»¶åªæœ‰ä¸¤ç§ redux-thunkã€redux-sagaï¼Œå½“ç„¶ redux-observable å¯èƒ½ä¹Ÿæœ‰èµ„æ ¼å æ®ä¸€å¸­ä¹‹åœ°ã€‚

## React-Redux æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Ÿ

- Provider: Provider çš„ä½œç”¨æ˜¯ä»æœ€å¤–éƒ¨å°è£…äº†æ•´ä¸ªåº”ç”¨ï¼Œå¹¶å‘ connect æ¨¡å—ä¼ é€’ store
- connect: è´Ÿè´£è¿æ¥ React å’Œ Redux
  - è·å– state: connect é€šè¿‡ context è·å– Provider ä¸­çš„ storeï¼Œé€šè¿‡ store.getState() è·å–æ•´ä¸ª store tree ä¸Šæ‰€æœ‰ state
  - åŒ…è£…åŸç»„ä»¶ï¼šå°† state å’Œ action é€šè¿‡ props çš„æ–¹å¼ä¼ å…¥åˆ°åŸç»„ä»¶å†…éƒ¨ wrapWithConnect è¿”å›ä¸€ä¸ª ReactComponent å¯¹è±¡ Connectï¼ŒConnect é‡æ–° render å¤–éƒ¨ä¼ å…¥çš„åŸç»„ä»¶ WrappedComponentï¼Œå¹¶æŠŠ connect ä¸­ä¼ å…¥çš„ mapStateToProps, mapDispatchToProps ä¸ç»„ä»¶ä¸ŠåŸæœ‰çš„ props åˆå¹¶åï¼Œé€šè¿‡å±æ€§çš„æ–¹å¼ä¼ ç»™ WrappedComponent
  - ç›‘å¬ store tree å˜åŒ–ï¼šconnect ç¼“å­˜äº† store tree ä¸­ state çš„çŠ¶æ€ï¼Œé€šè¿‡å½“å‰ state çŠ¶æ€å’Œå˜æ›´å‰ state çŠ¶æ€è¿›è¡Œæ¯”è¾ƒï¼Œä»è€Œç¡®å®šæ˜¯å¦è°ƒç”¨`this.setState()`æ–¹æ³•è§¦å‘ Connect åŠå…¶å­ç»„ä»¶çš„é‡æ–°æ¸²æŸ“

![react-redux å·¥ä½œæµç¨‹](../Images/react/reactRedux-life.png)

## Redux ä¸ Mobx çš„åŒºåˆ«ï¼Ÿ

**ä¸¤è€…å¯¹æ¯”ï¼š**

- redux å°†æ•°æ®ä¿å­˜åœ¨å•ä¸€çš„ store ä¸­ï¼Œmobx å°†æ•°æ®ä¿å­˜åœ¨åˆ†æ•£çš„å¤šä¸ª store ä¸­
- redux ä½¿ç”¨ plain object ä¿å­˜æ•°æ®ï¼Œéœ€è¦æ‰‹åŠ¨å¤„ç†å˜åŒ–åçš„æ“ä½œï¼›mobx é€‚ç”¨ observable ä¿å­˜æ•°æ®ï¼Œæ•°æ®å˜åŒ–åè‡ªåŠ¨å¤„ç†å“åº”çš„æ“ä½œ
- redux ä½¿ç”¨ä¸å¯å˜çŠ¶æ€ï¼Œè¿™æ„å‘³ç€çŠ¶æ€æ˜¯åªè¯»çš„ï¼Œä¸èƒ½ç›´æ¥å»ä¿®æ”¹å®ƒï¼Œè€Œæ˜¯åº”è¯¥è¿”å›ä¸€ä¸ªæ–°çš„çŠ¶æ€ï¼ŒåŒæ—¶ä½¿ç”¨çº¯å‡½æ•°ï¼›mobx ä¸­çš„çŠ¶æ€æ˜¯å¯å˜çš„ï¼Œå¯ä»¥ç›´æ¥å¯¹å…¶è¿›è¡Œä¿®æ”¹
- mobx ç›¸å¯¹æ¥è¯´æ¯”è¾ƒç®€å•ï¼Œåœ¨å…¶ä¸­æœ‰å¾ˆå¤šçš„æŠ½è±¡ï¼Œmobx æ›´å¤šçš„ä½¿ç”¨é¢å‘å¯¹è±¡çš„ç¼–ç¨‹æ€ç»´ï¼›redux ä¼šæ¯”è¾ƒå¤æ‚ï¼Œå› ä¸ºå…¶ä¸­çš„å‡½æ•°å¼ç¼–ç¨‹æ€æƒ³æŒæ¡èµ·æ¥ä¸æ˜¯é‚£ä¹ˆå®¹æ˜“ï¼ŒåŒæ—¶éœ€è¦å€ŸåŠ©ä¸€ç³»åˆ—çš„ä¸­é—´ä»¶æ¥å¤„ç†å¼‚æ­¥å’Œå‰¯ä½œç”¨
- mobx ä¸­æœ‰æ›´å¤šçš„æŠ½è±¡å’Œå°è£…ï¼Œè°ƒè¯•ä¼šæ¯”è¾ƒå›°éš¾ï¼ŒåŒæ—¶ç»“æœä¹Ÿéš¾ä»¥é¢„æµ‹ï¼›è€Œ redux æä¾›èƒ½å¤Ÿè¿›è¡Œæ—¶é—´å›æº¯çš„å¼€å‘å·¥å…·ï¼ŒåŒæ—¶å…¶çº¯å‡½æ•°ä»¥åŠæ›´å°‘çš„æŠ½è±¡ï¼Œè®©è°ƒè¯•å˜å¾—æ›´åŠ çš„å®¹æ˜“

**åœºæ™¯è¾¨æï¼š**

åŸºäºä»¥ä¸ŠåŒºåˆ«ï¼Œæˆ‘ä»¬å¯ä»¥ç®€å•å¾—åˆ†æä¸€ä¸‹ä¸¤è€…çš„ä¸åŒä½¿ç”¨åœºæ™¯ã€‚

mobx æ›´é€‚åˆæ•°æ®ä¸å¤æ‚çš„åº”ç”¨ï¼šmobx éš¾ä»¥è°ƒè¯•ï¼Œå¾ˆå¤šçŠ¶æ€æ— æ³•å›æº¯ï¼Œé¢å¯¹å¤æ‚åº¦é«˜çš„åº”ç”¨æ—¶ï¼Œå¾€å¾€åŠ›ä¸ä»å¿ƒã€‚

redux é€‚åˆæœ‰å›æº¯éœ€æ±‚çš„åº”ç”¨ï¼šæ¯”å¦‚ä¸€ä¸ªç”»æ¿åº”ç”¨ã€ä¸€ä¸ªè¡¨æ ¼åº”ç”¨ï¼Œå¾ˆå¤šæ—¶å€™éœ€è¦æ’¤é”€ã€é‡åšç­‰æ“ä½œï¼Œç”±äº redux ä¸å¯å˜çš„ç‰¹æ€§ï¼Œå¤©ç„¶æ”¯æŒè¿™äº›æ“ä½œã€‚

mobx é€‚åˆçŸ­å¹³å¿«çš„é¡¹ç›®ï¼šmobx ä¸Šæ‰‹ç®€å•ï¼Œæ ·æ¿ä»£ç å°‘ï¼Œå¯ä»¥å¾ˆå¤§ç¨‹åº¦ä¸Šæé«˜å¼€å‘æ•ˆç‡ã€‚

å½“ç„¶ mobx å’Œ redux ä¹Ÿå¹¶ä¸ä¸€å®šæ˜¯éæ­¤å³å½¼çš„å…³ç³»ï¼Œä½ ä¹Ÿå¯ä»¥åœ¨é¡¹ç›®ä¸­ç”¨ redux ä½œä¸ºå…¨å±€çŠ¶æ€ç®¡ç†ï¼Œç”¨ mobx ä½œä¸ºç»„ä»¶å±€éƒ¨çŠ¶æ€ç®¡ç†å™¨æ¥ç”¨ã€‚

## React-Hooks

> - [å‡½æ•°å¼ç»„ä»¶ä¸ç±»ç»„ä»¶æœ‰ä½•ä¸åŒ](https://overreacted.io/zh-hans/how-are-function-components-different-from-classes/)
> - [useEffect å®Œæ•´æŒ‡å—](https://overreacted.io/zh-hans/a-complete-guide-to-useeffect/)

