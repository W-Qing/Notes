<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Vue | Mintnoii&#39;s Notes</title>
    <meta name="description" content=" 📖 🤔 👨🏻‍💻 ">
    <link rel="icon" href="/img/favorite.ico">
    
    <link rel="preload" href="/assets/css/0.styles.1b99550c.css" as="style"><link rel="preload" href="/assets/js/app.9984aab2.js" as="script"><link rel="preload" href="/assets/js/2.0fac7938.js" as="script"><link rel="preload" href="/assets/js/11.8419d808.js" as="script"><link rel="prefetch" href="/assets/js/10.fbe814e3.js"><link rel="prefetch" href="/assets/js/12.773fd6fe.js"><link rel="prefetch" href="/assets/js/13.5975e56b.js"><link rel="prefetch" href="/assets/js/14.bc62301c.js"><link rel="prefetch" href="/assets/js/15.8d3ada72.js"><link rel="prefetch" href="/assets/js/16.198ad83f.js"><link rel="prefetch" href="/assets/js/17.2b813073.js"><link rel="prefetch" href="/assets/js/18.fe6d7f4d.js"><link rel="prefetch" href="/assets/js/19.10eed8e9.js"><link rel="prefetch" href="/assets/js/20.69ca5c1f.js"><link rel="prefetch" href="/assets/js/21.14fc5229.js"><link rel="prefetch" href="/assets/js/3.17b694f5.js"><link rel="prefetch" href="/assets/js/4.ef290b6b.js"><link rel="prefetch" href="/assets/js/5.96e50475.js"><link rel="prefetch" href="/assets/js/6.af14ba40.js"><link rel="prefetch" href="/assets/js/7.1146c45d.js"><link rel="prefetch" href="/assets/js/8.0dabff96.js"><link rel="prefetch" href="/assets/js/9.1104e6ba.js">
    <link rel="stylesheet" href="/assets/css/0.styles.1b99550c.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Mintnoii's Notes</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">Home</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="FE" class="dropdown-title"><span class="title">FE</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>Basic</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/Frontend/HTML/" class="nav-link">HTML</a></li><li class="dropdown-subitem"><a href="/Frontend/CSS/" class="nav-link">CSS</a></li><li class="dropdown-subitem"><a href="/Frontend/JavaScript/" class="nav-link">JavaScript</a></li><li class="dropdown-subitem"><a href="/Frontend/Browser/" class="nav-link">Browser</a></li></ul></li><li class="dropdown-item"><h4>Engineering</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/Frontend/Webpack/" class="nav-link">Webpack</a></li><li class="dropdown-subitem"><a href="/Frontend/Git/" class="nav-link">Git</a></li></ul></li><li class="dropdown-item"><h4>Framework</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/Frontend/Vue/" class="nav-link router-link-exact-active router-link-active">Vue</a></li><li class="dropdown-subitem"><a href="/Frontend/React/" class="nav-link">React</a></li><li class="dropdown-subitem"><a href="/Frontend/ReactFiber/" class="nav-link">React Fiber</a></li></ul></li><li class="dropdown-item"><h4>Security</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/Frontend/Security/" class="nav-link">Security</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="CS" class="dropdown-title"><span class="title">CS</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>Net protocol</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/CS/HTTP/" class="nav-link">HTTP</a></li><li class="dropdown-subitem"><a href="/CS/TCP/" class="nav-link">TCP</a></li></ul></li></ul></div></div><div class="nav-item"><a href="https://www.notion.so/Hi-here-0a4a01ce46dc475a9318075eda4ad3b0" target="_blank" rel="noopener noreferrer" class="nav-link external">
  About
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://github.com/W-Qing/Notes" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">Home</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="FE" class="dropdown-title"><span class="title">FE</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>Basic</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/Frontend/HTML/" class="nav-link">HTML</a></li><li class="dropdown-subitem"><a href="/Frontend/CSS/" class="nav-link">CSS</a></li><li class="dropdown-subitem"><a href="/Frontend/JavaScript/" class="nav-link">JavaScript</a></li><li class="dropdown-subitem"><a href="/Frontend/Browser/" class="nav-link">Browser</a></li></ul></li><li class="dropdown-item"><h4>Engineering</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/Frontend/Webpack/" class="nav-link">Webpack</a></li><li class="dropdown-subitem"><a href="/Frontend/Git/" class="nav-link">Git</a></li></ul></li><li class="dropdown-item"><h4>Framework</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/Frontend/Vue/" class="nav-link router-link-exact-active router-link-active">Vue</a></li><li class="dropdown-subitem"><a href="/Frontend/React/" class="nav-link">React</a></li><li class="dropdown-subitem"><a href="/Frontend/ReactFiber/" class="nav-link">React Fiber</a></li></ul></li><li class="dropdown-item"><h4>Security</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/Frontend/Security/" class="nav-link">Security</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="CS" class="dropdown-title"><span class="title">CS</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>Net protocol</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/CS/HTTP/" class="nav-link">HTTP</a></li><li class="dropdown-subitem"><a href="/CS/TCP/" class="nav-link">TCP</a></li></ul></li></ul></div></div><div class="nav-item"><a href="https://www.notion.so/Hi-here-0a4a01ce46dc475a9318075eda4ad3b0" target="_blank" rel="noopener noreferrer" class="nav-link external">
  About
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://github.com/W-Qing/Notes" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>基础</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>工程化</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>框架</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/Frontend/Framework/" class="sidebar-link">通识</a></li><li><a href="/Frontend/Vue/" class="active sidebar-link">Vue</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Frontend/Vue/#生命周期分析" class="sidebar-link">生命周期分析</a></li><li class="sidebar-sub-header"><a href="/Frontend/Vue/#组件通信" class="sidebar-link">组件通信</a></li><li class="sidebar-sub-header"><a href="/Frontend/Vue/#computed-和-watch-的区别-🌟" class="sidebar-link">computed 和 watch 的区别 🌟</a></li><li class="sidebar-sub-header"><a href="/Frontend/Vue/#vue-实现双向绑定的原理🌟" class="sidebar-link">Vue 实现双向绑定的原理🌟</a></li><li class="sidebar-sub-header"><a href="/Frontend/Vue/#nexttick-原理分析" class="sidebar-link">NextTick 原理分析</a></li><li class="sidebar-sub-header"><a href="/Frontend/Vue/#如何理解-vue-的响应式系统？" class="sidebar-link">如何理解 Vue 的响应式系统？</a></li><li class="sidebar-sub-header"><a href="/Frontend/Vue/#既然-vue-通过数据劫持可以精准探测数据变化，为什么还需要虚拟-dom-进行-diff-检测差异？🌟" class="sidebar-link">既然 Vue 通过数据劫持可以精准探测数据变化，为什么还需要虚拟 DOM 进行 diff 检测差异？🌟</a></li><li class="sidebar-sub-header"><a href="/Frontend/Vue/#vue-为什么没有类似于-react-中-shouldcomponentupdate-的生命周期？🌟" class="sidebar-link">Vue 为什么没有类似于 React 中 shouldComponentUpdate 的生命周期？🌟</a></li><li class="sidebar-sub-header"><a href="/Frontend/Vue/#vue-中的-key-到底有什么用？" class="sidebar-link">Vue 中的 key 到底有什么用？</a></li></ul></li><li><a href="/Frontend/React/" class="sidebar-link">React</a></li><li><a href="/Frontend/ReactFiber/" class="sidebar-link">React Fiber</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>安全</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="vue"><a href="#vue" class="header-anchor">#</a> Vue</h1> <p><a href="https://www.bilibili.com/video/BV1SZ4y157m8" target="_blank" rel="noopener noreferrer">Vue3.0（正式版）+ Vite开发快速入门<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h2 id="生命周期分析"><a href="#生命周期分析" class="header-anchor">#</a> 生命周期分析</h2> <p><strong>生命周期是什么？</strong></p> <p>Vue 实例有一个完整的生命周期，也就是从开始创建、初始化数据、编译模版、挂载 Dom =&gt; 渲染、更新 =&gt; 渲染、卸载等一系列过程，我们称这是 Vue 的生命周期。</p> <p>其中，生命周期函数就是组件在初始化或者数据更新时会触发的钩子函数。</p> <p><strong>生命周期示意图：</strong></p> <p><img src="/assets/img/lifescyles.d1279e6d.png" alt="vue 生命周期分析"></p> <p>📖 官方实例的异步请求是在 mounted 生命周期中调用的，而实际上也可以在 created 生命周期中调用。</p> <p><strong>各个生命周期的作用：</strong></p> <table><thead><tr><th>生命周期</th> <th>描述</th></tr></thead> <tbody><tr><td>beforeCreate</td> <td>组件实例被创建之初，组件的属性生效之前</td></tr> <tr><td>created</td> <td>组件实例已经完全创建，属性也绑定，但真实 dom 还没有生成，<code>$el</code>还不可用</td></tr> <tr><td>beforeMount</td> <td>在挂载开始之前被调用：相关的 render 函数首次被调用</td></tr> <tr><td>mounted</td> <td>el 被新创建的 vm.$el 替换，并挂载到实例上去之后调用该钩子</td></tr> <tr><td>beforeUpdate</td> <td>组件数据更新之前调用，发生在虚拟 DOM 打补丁之前</td></tr> <tr><td>update</td> <td>组件数据更新之后</td></tr> <tr><td>activited</td> <td>keep-alive 专属，组件被激活时调用</td></tr> <tr><td>deadctivated</td> <td>keep-alive 专属，组件被销毁时调用</td></tr> <tr><td>beforeDestory</td> <td>组件销毁前调用</td></tr> <tr><td>destoryed</td> <td>组件销毁后调用</td></tr></tbody></table> <h2 id="组件通信"><a href="#组件通信" class="header-anchor">#</a> 组件通信</h2> <ul><li><code>props</code> 和<code>$emit + v-on</code>：通过 <code>props</code>将数据自上而下传递，而通过<code>$emit</code>和<code>v-on</code>来向上传递信息</li> <li>EventBus：通过 EventBus 进行信息的发布与订阅</li> <li>vuex：是全局数据管理库，可以通过 vuex 管理全局的数据流</li> <li><code>$attrs/$listeners</code>： Vue2.4 中加入的<code>$attrs/$listeners</code>可以进行跨级的组件通信</li> <li><code>provide/inject</code>：以允许一个祖先组件向其所有子孙后代注入一个依赖，不论组件层次有多深，并在起上下游关系成立的时间里始终生效，这成为了跨组件通信的基础</li></ul> <p>还有一些利用 solt 插槽或者 ref 实例进行通信的方法，因为使用场景过于有限不再赘述。</p> <blockquote><p>推荐阅读：<a href="https://juejin.im/post/5d267dcdf265da1b957081a3" target="_blank" rel="noopener noreferrer">vue 中 8 种组件通信方式<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p>太偏门的通信方式根本不会用到，单做知识点了解即可</p></blockquote> <h2 id="computed-和-watch-的区别-🌟"><a href="#computed-和-watch-的区别-🌟" class="header-anchor">#</a> computed 和 watch 的区别 🌟</h2> <p><strong>computed：</strong></p> <ol><li><code>computed</code>是计算属性，也就是计算值，它更多用于计算值的场景</li> <li><code>computed</code>具有缓存性，computed 的值在 getter 执行后是会缓存的，只有在它依赖的属性值改变之后，下一次获取 computed 的值时才会重新调用对应的 getter 来计算</li> <li><code>computed</code>适用于计算比较消耗性能的计算场景</li></ol> <p><strong>watch：</strong></p> <ol><li>更多的是「观察」的作用，类似于某些数据的监听回调，用于观察<code>props</code> 、<code>$emit</code>或者本组件的值，当数据变化时来执行回调进行后续操作</li> <li>没有缓存性，页面重新渲染时值不变化也会执行</li></ol> <p><strong>用法：</strong></p> <ol><li>当我们要进行数值计算，而且依赖于其他数据，那么把这个数据设计为 computed</li> <li>如果你需要在某个数据变化时做一些事情，使用 watch 来观察这个数据变化</li></ol> <h2 id="vue-实现双向绑定的原理🌟"><a href="#vue-实现双向绑定的原理🌟" class="header-anchor">#</a> Vue 实现双向绑定的原理🌟</h2> <p>利用<code>Object.defineProperty</code>劫持对象的访问器，在属性值发生变化时我们可以获取变化，然后根据变化进行后续响应，在 vue3.0 中通过 Proxy 代理对象进行类似的操作。</p> <h3 id="proxy-与-object-defineproperty-的对比？"><a href="#proxy-与-object-defineproperty-的对比？" class="header-anchor">#</a> Proxy 与 Object.defineProperty 的对比？</h3> <p>Proxy 的优势如下：</p> <ul><li>Proxy 可以直接监听对象而非属性</li> <li>Proxy 可以直接监听数组的变化</li> <li>Proxy 有多达 13 种拦截方法，不限于 apply、ownKeys、deleteProperty、has 等等是<code>Object.defineProperty</code>不具备的</li> <li>Proxy 返回的是一个新对象，我们可以只操作新的对象达到目的，而<code>Object.defineProperty</code>只能遍历对象属性直接修改</li> <li>Proxy 作为新标准将受到浏览器厂商重点持续的性能优化，也就是传说中的新标准的性能红利</li></ul> <p>Object.defineProperty 的优势：</p> <ul><li>兼容性好，支持 IE9</li></ul> <blockquote><p>推荐阅读：详细对比与实现请见 <a href="https://www.cxymsg.com/guide/devsProxy.html" target="_blank" rel="noopener noreferrer">Proxy 比 defineproperty 优劣对比？<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></blockquote> <h2 id="nexttick-原理分析"><a href="#nexttick-原理分析" class="header-anchor">#</a> NextTick 原理分析</h2> <p><code>nextTick</code> 可以让我们在下次 DOM 更新循环结束之后执行延迟回调，用于获得更新后的 DOM。</p> <p>在 Vue 2.4 之前都是使用的 microtasks，但是 microtasks 的优先级过高，在某些情况下可能会出现比事件冒泡更快的情况，但如果都使用 macrotasks 又可能会出现渲染的性能问题。所以在新版本中，会默认使用 microtasks，但在特殊情况下会使用 macrotasks，比如 v-on。</p> <p>对于实现 macrotasks ，会先判断是否能使用 <code>setImmediate</code> ，不能的话降级为 <code>MessageChannel</code> ，以上都不行的话就使用 <code>setTimeout</code></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> setImmediate <span class="token operator">!==</span> <span class="token string">'undefined'</span> <span class="token operator">&amp;&amp;</span> <span class="token function">isNative</span><span class="token punctuation">(</span>setImmediate<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function-variable function">macroTimerFunc</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">setImmediate</span><span class="token punctuation">(</span>flushCallbacks<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>
  <span class="token keyword">typeof</span> MessageChannel <span class="token operator">!==</span> <span class="token string">'undefined'</span> <span class="token operator">&amp;&amp;</span>
  <span class="token punctuation">(</span><span class="token function">isNative</span><span class="token punctuation">(</span>MessageChannel<span class="token punctuation">)</span> <span class="token operator">||</span>
    <span class="token comment">// PhantomJS</span>
    MessageChannel<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token string">'[object MessageChannelConstructor]'</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> channel <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MessageChannel</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> port <span class="token operator">=</span> channel<span class="token punctuation">.</span>port2
  channel<span class="token punctuation">.</span>port1<span class="token punctuation">.</span>onmessage <span class="token operator">=</span> flushCallbacks
  <span class="token function-variable function">macroTimerFunc</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    port<span class="token punctuation">.</span><span class="token function">postMessage</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
  <span class="token comment">/* istanbul ignore next */</span>
  <span class="token function-variable function">macroTimerFunc</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span>flushCallbacks<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><code>nextTick</code> 同时也支持 Promise 的使用，会判断是否实现了 Promise</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">nextTick</span><span class="token punctuation">(</span><span class="token parameter">cb<span class="token operator">?</span><span class="token operator">:</span> Function<span class="token punctuation">,</span> ctx<span class="token operator">?</span><span class="token operator">:</span> Object</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> _resolve
  <span class="token comment">// 将回调函数整合进一个数组中</span>
  callbacks<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>cb<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token function">cb</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>ctx<span class="token punctuation">)</span>
      <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">handleError</span><span class="token punctuation">(</span>e<span class="token punctuation">,</span> ctx<span class="token punctuation">,</span> <span class="token string">'nextTick'</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>_resolve<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">_resolve</span><span class="token punctuation">(</span>ctx<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>pending<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    pending <span class="token operator">=</span> <span class="token boolean">true</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>useMacroTask<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">macroTimerFunc</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token function">microTimerFunc</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// 判断是否可以使用 Promise</span>
  <span class="token comment">// 可以的话给 _resolve 赋值</span>
  <span class="token comment">// 这样回调函数就能以 promise 的方式调用</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>cb <span class="token operator">&amp;&amp;</span> <span class="token keyword">typeof</span> Promise <span class="token operator">!==</span> <span class="token string">'undefined'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token parameter">resolve</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      _resolve <span class="token operator">=</span> resolve
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="如何理解-vue-的响应式系统？"><a href="#如何理解-vue-的响应式系统？" class="header-anchor">#</a> 如何理解 Vue 的响应式系统？</h2> <p><img src="/assets/img/responsiveSystem.d5bfe6c9.png" alt="responsiveSystem"></p> <p>响应式系统简述：</p> <ul><li>任何一个 Vue Component 都有一个与之对应的 Watcher 实例。</li> <li>Vue 的 data 上的属性会被添加 getter 和 setter 属性。</li> <li>当 Vue Component render 函数被执行的时候，data 会被触碰 (touch)，即被读， getter 方法会被调用， 此时 Vue 会去记录此 Vue component 所依赖的所有 data。（这一过程被称为依赖收集）</li> <li>data 被改动时（主要是用户操作）， 即被写，setter 方法会被调用，此时 Vue 会去通知所有依赖于此 data 的组件去调用他们的 render 函数进行更新。</li></ul> <blockquote><p><a href="https://www.cxymsg.com/guide/reactivity.html" target="_blank" rel="noopener noreferrer">深入响应式系统<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></blockquote> <h2 id="既然-vue-通过数据劫持可以精准探测数据变化，为什么还需要虚拟-dom-进行-diff-检测差异？🌟"><a href="#既然-vue-通过数据劫持可以精准探测数据变化，为什么还需要虚拟-dom-进行-diff-检测差异？🌟" class="header-anchor">#</a> 既然 Vue 通过数据劫持可以精准探测数据变化，为什么还需要虚拟 DOM 进行 diff 检测差异？🌟</h2> <p>考点：Vue 的变化侦测原理</p> <p>前置知识：依赖收集、虚拟 DOM、响应式系统</p> <p>现代前端框架有两种方式侦测变化，一种是 pull 一种是 push</p> <p>pull: 其代表为 React，我们可以回忆一下 React 是如何侦测到变化的，我们通常会用<code>setState</code>API 显式更新，然后 React 会进行一层层的 Virtual Dom Diff 操作找出差异，然后 Patch 到 DOM 上，React 从一开始就不知道到底是哪发生了变化，只是知道「有变化了」，然后再进行比较暴力的 Diff 操作查找「哪发生变化了」，另外一个代表就是 Angular 的脏检查操作。</p> <p>push: Vue 的响应式系统则是 push 的代表，当 Vue 程序初始化的时候就会对数据 data 进行依赖的收集，一旦数据发生变化，响应式系统就会立刻得知，因此 Vue 是一开始就知道是「在哪发生变化了」，但是这又会产生一个问题，如果你熟悉 Vue 的响应式系统就知道，通常绑定一个数据就需要一个 Watcher, 如果我们的绑定细粒度过高就会产生大量的 Watcher，这会带来内存以及依赖追踪的开销，而细粒度过低又会无法精准侦测变化。因此 Vue 的设计是选择中等细粒度的方案，在组件级别进行 push 侦测的方式，也就是那套响应式系统。通常我们会第一时间侦测到发生变化的组件，然后在组件内部进行 Virtual Dom Diff 获取更加具体的差异，而 Virtual Dom Diff 则是 pull 操作，Vue 是 push+pull 结合的方式进行变化侦测的。</p> <h2 id="vue-为什么没有类似于-react-中-shouldcomponentupdate-的生命周期？🌟"><a href="#vue-为什么没有类似于-react-中-shouldcomponentupdate-的生命周期？🌟" class="header-anchor">#</a> Vue 为什么没有类似于 React 中 shouldComponentUpdate 的生命周期？🌟</h2> <p>考点：Vue 的变化侦测原理</p> <p>前置知识：依赖收集、虚拟 DOM、响应式系统</p> <p><strong>根本原因是 Vue 与 React 的变化侦测方式有所不同</strong></p> <p>React 是 pull 的方式侦测变化，当 React 知道发生变化后，会使用 Virtual Dom Diff 进行差异检测，但是很多组件实际上是肯定不会发生变化的，这个时候需要用 shouldComponentUpdate 进行手动操作来减少 diff，从而提高程序整体的性能。</p> <p>Vue 是 pull+push 的方式侦测变化的，在一开始就知道那个组件发生了变化，因此在 push 的阶段并不需要手动控制 diff。而组件内部采用的 diff 方式实际上是可以引入类似于 shouldComponentUpdate 相关生命周期的，但是通常合理大小的组件不会有过量的 diff，手动优化的价值有限，因此目前 Vue 并没有考虑引入 shouldComponentUpdate 这种手动优化的生命周期。</p> <h2 id="vue-中的-key-到底有什么用？"><a href="#vue-中的-key-到底有什么用？" class="header-anchor">#</a> Vue 中的 key 到底有什么用？</h2> <p><code>key</code>是为 Vue 中的 vnode 标记的唯一 id，通过这个 key，我们的 diff 操作可以更准确、更快速。diff 算法的过程中先会进行新旧节点的首尾交叉对比，当无法匹配的时候会用新节点的<code>key</code>与旧节点进行比对，然后找出差异。</p> <blockquote><p>diff 程可以概括为：oldCh 和 newCh 各有两个头尾的变量 StartIdx 和 EndIdx，它们的 2 个变量相互比较，一共有 4 种比较方式。如果 4 种比较都没匹配，如果设置了 key，就会用 key 进行比较，在比较的过程中，变量会往中间靠，一旦 StartIdx&gt;EndIdx 表明 oldCh 和 newCh 至少有一个已经遍历完了，就会结束比较，这四种比较方式就是首、尾、旧尾新头、旧头新尾。</p></blockquote> <ul><li>准确：如果不加<code>key</code>，那么 vue 会选择复用节点 (Vue 的就地更新策略），导致之前节点的状态被保留下来，会产生一系列的 bug。</li> <li>快速：key 的唯一性可以被 Map 数据结构充分利用，相比于遍历查找的时间复杂度 O(n)，Map 的时间复杂度仅仅为 O(1)。</li></ul></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/Frontend/Framework/" class="prev">通识</a></span> <span class="next"><a href="/Frontend/React/">React</a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.9984aab2.js" defer></script><script src="/assets/js/2.0fac7938.js" defer></script><script src="/assets/js/11.8419d808.js" defer></script>
  </body>
</html>
